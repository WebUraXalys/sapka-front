<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.1/dist/full.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="pages/styles/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="./app.js"></script>
    <script>
    window.onload = (event) => {
        console.log("page is fully loaded");
    };
    document.addEventListener('alpine:init', () => {
        const socket = new WebSocket('ws://localhost:8000/ai/wschat');
        let tst = document.getElementById("123");

        let data = { messages: [] }
    
        let reactiveData = Alpine.reactive(data)

    socket.onmessage = function(event) {
        const recv = event.data;
        const recv_json = JSON.parse(recv);
        if (recv_json["role"] == "part") {
            tst.textContent = tst.textContent + recv_json["text"];
        }
        if (recv_json["role"] == "finished") {
            reactiveData.messages.push(recv_json["text"]);
        }
        if (recv_json["role"] == "end") {
            alert("not implemented in front")
        }
    };

        Alpine.store('wschat', {
            socket: socket,
            messages: reactiveData,
            inputParams: (location.pathname+location.search).substr(1)
        })
    })
    </script>
</head>
<body>
<div class="main-block">
    <div class="container">
        <div class="flex justify-center mb-5">
            <img src="static/images/logo_believe.svg" alt="Logo">
        </div>
        <div x-data="{query: ''}">
            <input type="text" class="grow" placeholder="Search" x-model="query" />
            <button
                @click="$store.wschat.messages.messages.push(query); $store.wschat.socket.send(JSON.stringify({role: 'user', text: query})); query = ''">submit</button>
        </div>
        <div class="chat">
            
        </div>
            <div class="chat chat-end">
                <div class="chat-image avatar">
                    <div class="w-10 rounded-full">
                        <img alt="Tailwind CSS chat bubble component"
                            src="https://daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg" />
                    </div>
                </div>
                <div class="chat-header">
                    Ви
                </div>
                <div class="chat-bubble">I hate you!</div>
            </div>
            <div class="chat chat-start">
                <div class="chat-image avatar">
                    <div class="w-10 rounded-full">
                        <img alt="Tailwind CSS chat bubble component"
                            src="https://daisyui.com/images/stock/photo-1534528741775-53994a69daeb.jpg" />
                    </div>
                </div>
                <div class="chat-header">
                    Віра Асистент
                </div>
                <div class="chat-bubble" id="123">You were the Chosen One!</div>
            </div>
            
        </div>
        
    </div>
</div>
</body>
</html>